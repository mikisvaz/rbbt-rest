%dl.rbbt_accordion
  - container.lists.each do |id, list, text, options|
    - if Proc === list
      = fragment do
        - list = list.call
        - next if list.nil?
        %dt.next
          = list.list_link :length, id
          %span.title
            = text || id 
        %dd
          - if (defined? force and force) or list.length < 500
            = list.link * ", "
          - else
            = modal_fragment "Too many entities to list" do
              = list.link * ", "
    - else
      - if list.empty?
        %dt
          = 0
          %span.title
            = text || id 
      - else
        %dt.next
          = list.list_link :length, id
          %span.title
            = text || id 
        %dd
          - if (defined? force and force) or list.length < 500
            = list.link * ", "
          - else
            = reveal "Too many entities to list" do
              = fragment do
                = list.link * ", "


