- entity_card = EntityCard.new entity
- name = entity.respond_to?(:name)? entity.name || entity : entity

- if not entity.respond_to?(:long_name)
  - if entity.respond_to?(:name)
    - entity_card.name = [entity.base_type, entity] * ": "
  - else
    - entity_card.name = entity.base_type
  - entity_card.long_name = name

- if entity.respond_to? :genes
  - genes = entity.genes
  - list_container = ListContainer.new
  - list_container.add "Genes for #{[entity.base_type, name] * ": "}", genes
  - entity_card.list_container = list_container

- action_controller = ActionController.new(entity)

- find_all_entity_action_templates(entity).each do |action|
  - action_controller.add action, action

- entity_card.action_controller = action_controller

= entity_card_render entity_card

